
# Think In Turing Machine

> *作者：Arvin 日期：2017年6月7日*

----------------------------------------

>BEGIN

### 图灵机

-----------------------------------------

图灵机就是指一个抽象的机器，它有一条无限长的纸带，纸带分成了一个一个的小方格，每个方格有不同的颜色。有一个机器头在纸带上移来移去。机器头有一组内部状态，还有一些固定的程序。在每个时刻，机器头都要从当前纸带上读入一个方格信息，然后结合自己的内部状态查找程序表，根据程序输出信息到纸带方格上，并转换自己的内部状态，然后进行移动。

图灵的基本思想是用机器来模拟人们用纸笔进行数学运算的过程，他把这样的过程看作下列动作：

1. 在纸上写上或擦除某个符号；

2. 把注意力从纸的一个位置移动到另一个位置；

3. 而在每个阶段，人要决定下一步的动作，依赖于 (a) 此人当前所关注的纸上某个位置的符号和（b) 此人当前思维的状态。

### 思考

-------------------------------------------

经过上一篇的分析，CPU+Memory就能组成一个完整的图灵机。但是现代计算机CPU跟内存本身是固定的，CPU如何做到移动效果？移动的本质是读写不同位置的纸带信息。如果纸带能根据给出的位置读写信息，就不需要cpu移动了，cpu只需要给出地址信息、读写控制信息和读写信息就可以了。这就是现代计算机的设计方式，通过地址线、控制线、数据线把CPU的信息给到内存芯片，内存芯片按照三种信息进行对应操作。其中内存地址如何灵活的构建，需要cpu的支持，地址构建方式称作寻址模式。为了能支持不同的寻址模式，cpu中会集成多种地址寄存器。地址构成整体上符合加法规则。除了地址寄存器，还需要特定的地址跳转指令来完成地址寄存器的设置。可以认为，跳转指令是为了构建地址而存在的。还需要读写指令来控制读写控制操作。总线、地址寄存器、跳转指令、读写指令构成cpu的数据读写子系统。

CPU除了支持内存数据读写，还得支持数据运算，所以cpu提供了ALU硬件和对应的运算指令。其中，运算的中间结果和最终结果需要临时存放，所以cpu集成了几个数据寄存器。寄存器之间数据的移动还需要特定的数据移动指令。内存数据读写指令，可以认为是数据移动指令。ALU硬件实现的基本运算，可以认为是计算的基本规则，本质是模拟人的计算规则。规则是对事物的总结和模拟。为什么1+1=2，目前谁都不知道。我们可以用计算机硬件模拟器出01+01=10，即 11=[+]=10。如果两个输入都是1，则输出分别是1和0。硬件电路可以做到这个。运算会产生溢出、结果为0和结果为负数等状态，所以必须有寄存器存储该结果状态以备后面运算使用。ALU、数据寄存器、运算指令构成了cpu的计算子系统。

如何协调cpu的数据读写子系统和数据计算子系统呢？在这两个子系统之上还有一个总控系统，也就是cpu的控制器（控制核心）。最基本的，需要一个获取指令-执行指令循环。由于所有子系统都可以通过指令来进行控制，所以cpu的控制核心只需要建立起取指执指循环就可以让整个计算机（图灵机）系统持续的运行下去。如何建立循环呢？就需要额外的时钟芯片和计数器寄存器，产生稳定的时序周期信号。取指执指循环全部由硬件实现并且没有指令进行控制，不受人工干预。指令全部需要通过控制器进行解码才能在总线上产生对应的控制信息，控制相应的硬件进行对应的操作。指令基本都是对数据读写子系统和数据运算子系统进行控制和操作的。控制器通过指令完成了对读写子系统和运算子系统硬件的封装，提供给上层更简单的操作接口，实质是多种硬件控制信号到控制器指令信号的映射转换。理论上，可以跳过控制器进行底层硬件的直接控制，还可以修改控制器的指令信号到硬件控制信号的映射。控制器的输入是指令信号，输出是底层硬件的控制信号。从这种角度看，计算机就是一个计算实验室，给出指令和数据，底层硬件会根据计算规则模拟计算过程最后得到计算结果给用户。指令（控制器）是软件和硬件的分割线。基于控制器输入的（指令）都属于软件，基于控制器输出的（受硬件控制信号控制的）都属于硬件。基底现实和上层建筑。

现代计算机除了cpu和内存，还有诸多外设。你也可以认为内存是cpu的外设。如何让cpu操作外设呢？基本原理跟操作内存是一样的。只是将外设的内存（外设端口）映射到特定的地址，读写这些地址会让外设产生具体的操作（不一定全部可读写，不一定是读写操作）。由于地址是固定的，这些端口地址大部分是控制端口和数据端口。比如：你向键盘的控制端口写入“读”操作命令，键盘会将键盘当前信息写入键盘缓存区中。如何通知cpu键盘数据准备完成信息呢？中断机制。键盘会产生特定中断信息给cpu，cpu才会通过数据端口读取键盘信息。中断机制，是为了不让cpu等待慢速外设操作完成的一种提高cpu效率的机制。相反的是cpu轮询机制，需要cpu等待外设操作完成，等待过程cpu不能做任何事情。大量数据的传输也是非常耗时的，中断机制外设数据的读取是需要cpu参与的，并且中断需要保存现场和恢复现场。解决方式是DMA方法，需要额外的芯片来控制数据从外设到内存的传输过程，cpu初始化DMA芯片并将外设数据IO任务交给外设，外设提出DMA请求，然后DMA控制对应外设，外设完成任务后，通过DMA会将外设数据传输到相应的内存空间，完成传输后，DMA会告诉外设传输完成，外设会通知cpu任务和数据传输完成。

指令系统：数据读写指令、数据运算指令


>END
