
# 矢量图绘制的思考

> *作者：Arvin 日期：2018年04月18日*

---------------------------------

>BEGIN

先看[效果](http://arvinsfj.github.io/public/ctt/Tools/web2d/2d.html)，这是Demo效果，浏览器中绘制的矢量图。如何在电脑中绘制图形（特指矢量图）？基本的绘制原理是什么？需要满足哪些条件？我们需要探索一些基本原理。

### 一、思考和探索
---------------------------------

如[效果](http://arvinsfj.github.io/public/ctt/Tools/web2d/2d.html)所示，我们看到的是深灰色的背景和白黄绿线条（直线线段和曲线线段）相互连接组成的户型图前景。我们之所以能区分户型图和背景，是因为户型图的线条颜色跟背景颜色不同。更准确的说，线条所占像素点的颜色跟其他区域像素的颜色不同。这样的话，我们可以将整个图像区域看成一个二维数组，数组的列行分别对应图像的宽高，数组中的每个元素对应图像中的每个像素。以上，我们把图像抽象成二维数组，它就是“画布”（这个画布在不同的平台需要不同的方法显示在屏幕上）。画家有了画布和画笔就可以放飞自我，天马行空了。这里的画笔，对应计算机里面的绘制接口（API）。什么是绘制？绘制是一种动作，比如：将背景涂成深灰色，用白色画笔画一条直线或者曲线等。这些动作需要大脑的指导和控制，本质是绘制算法。画家通过不断的练习，已经习得了这些动作算法。计算机也需要这些算法，才能绘制。进一步思考，绘制一条直线线段我们需要确定哪些东西？首先是绘制的起点和终点，其次是如何填充这两点之间的像素点（算法）。填充两点之间的像素点，首先需要根据直线方程确定填充点在画布中的位置坐标，再就是设置像素值（数组赋值，像素值决定了颜色）。曲线跟直线的唯一不同是位置坐标的计算方法不同，曲线使用（抛物线）曲线方程计算位置坐标。以上，我们把绘制动作抽象成按照不同方程确定填充位置并设置像素颜色的过程。在计算机里面，我们把二维数组（画布）和绘制API（绘制算法）包装在一个类里面，形成一个完整的绘制类，对外只提供绘制API，进行调用绘图。有了绘制类这个基础设施，可以进行基本的绘制，但是还不能绘制出效果的户型图。我们还需要户型图的点线数据和调用绘制API（传递点线数据给绘制API）。这些数据是自定义的业务数据，这些数据的使用方法就是业务逻辑了。

绘制类，在HTML5中有canvas和webgl，在ios中有Quartz2D和OpenGLES，等等吧。业务数据和逻辑部分可以使用C语言进行统一编写，但是绘制类的实现各不相同，提供的API也不相同，这就导致业务代码部分调用的方法有区别，最终导致业务代码缺乏最好的通用性，不能跨平台。不过，我们可以使用代理方法，让业务代码部分只使用我们自己定义的绘制代理API，而这些代理方法的实现部分交给平台处理。


### 二、总结
---------------------------------

1. 分析事物的组成构件，找到最基本的结构和属性。
2. 一步一步重构整个事物，找出构造过程和算法。
3. 在计算机中，找到对应的事物。
4. 使用编程语言思维进行再次重构，找出计算机构造算法。
5. 包装对应物和构造算法，形成基本的事物类。
6. 业务需要自定义数据和数据使用方法。
7. 事物类和业务方法的结合部是事物类API的调用，最好使用代理方法规避通用性问题。


>END

